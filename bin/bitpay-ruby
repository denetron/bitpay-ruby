#!/usr/bin/env ruby

require "bundler"
Bundler.require :default

require File.dirname(__FILE__) + "/../lib/bitpay-ruby"
include BitPayRuby

require "optparse"

begin
  options = {}
  optparse = OptionParser.new do |opts|
    opts.banner = "Usage: #{$0} [options]"
    # create an invoice
    opts.on("-c", "--create PRICE CURRENCY", "Create an invoice.") do |price, currency|
      i = Invoice.new(price.to_f, currency)
      i.create
      $stdout.puts i.to_s
      exit
    end

    # fetch an invoice status
    opts.on("-f", "--fetch ID", "Fetch an invoice status.") do |id|
      i = Invoice.fetch(id)
      $stdout.puts i.to_s
      exit
    end

    # version
    opts.on("-v", "--version", "Show the version number.") do
      $stdout.puts "0.1.0"
      exit
    end

    # help
    opts.on("-h", "--help", "Show this help message.") do
      $stdout.puts opts
      exit
    end
  end
  optparse.parse!
rescue BitPayRubyError => e
  $stderr.puts e.message
  exit e.status_code
rescue Interrupt => e
  exit 1
end
